{% extends 'base.html.twig' %}

{% block active %}
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item">
                <a class="nav-link" href="/templatefrontoffice">HOME</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="{{ path('app_annonce_index_front') }}">SHOP</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/templatefrontoffice/collecte">COLLECT</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/templatefrontoffice/forum">FORUM</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/templatefrontoffice/reclamation">RECLAMATION</a>
            </li>
        </ul>
    </div>
{% endblock %}

{% block body %}
<main class="main">
    <div class="container" data-aos="fade-up">
        <!-- Barre de recherche en haut de la page -->
        <div class="row mt-4 mb-4">
            <div class="col-12">
                <div class="search-container">
                    <form method="get" action="{{ path('app_annonce_search') }}" class="search-form">
                        <div class="input-group">
                            <input 
                                type="text" 
                                name="q" 
                                class="form-control search-input" 
                                placeholder="Rechercher une annonce..." 
                                value="{{ searchTerm|default('') }}"
                                aria-label="Rechercher une annonce"
                            >
                            <button class="btn search-btn" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="row shop-container">
            <!-- Sidebar de filtrage à gauche -->
            <div class="col-lg-3 col-md-4 mb-4">
                <div class="filter-sidebar">
                    <div class="filter-header">
                        <h4>Filtres</h4>
                    </div>
                    <form method="get" action="{{ app.request.get('_route') == 'app_annonce_search' ? path('app_annonce_search') : path('app_annonce_index_front') }}">
                        {% if app.request.get('_route') == 'app_annonce_search' and searchTerm is defined %}
                            <input type="hidden" name="q" value="{{ searchTerm }}">
                        {% endif %}
                        
                        <!-- Prix min et max -->
                        <div class="filter-section">
                            <h5 class="filter-title">Prix</h5>
                            <div class="input-group mb-2">
                                <span class="input-group-text">Min$</span>
                                <input type="number" name="min_price" id="min_price" class="form-control" value="{{ minPrice }}">
                            </div>
                            <div class="input-group">
                                <span class="input-group-text">Max$</span>
                                <input type="number" name="max_price" id="max_price" class="form-control" value="{{ maxPrice }}">
                            </div>
                        </div>
                        
                        <!-- Poids min et max -->
                        <div class="filter-section">
                            <h5 class="filter-title">Poids</h5>
                            <div class="input-group mb-2">
                                <span class="input-group-text">Min kg</span>
                                <input type="number" name="min_weight" id="min_weight" class="form-control" value="{{ minWeight }}">
                            </div>
                            <div class="input-group">
                                <span class="input-group-text">Max kg</span>
                                <input type="number" name="max_weight" id="max_weight" class="form-control" value="{{ maxWeight }}">
                            </div>
                        </div>
                        
                        <!-- Tri des annonces -->
                        <div class="filter-section">
                            <h5 class="filter-title">Trier par</h5>
                            <select name="sort_by" id="sort_by" class="form-select">
                                <option value="a.id" {{ sortBy == 'a.id' ? 'selected' }}>Par défaut</option>
                                <option value="a.prix" {{ sortBy == 'a.prix' ? 'selected' }}>Prix croissant</option>
                                <option value="a.poids" {{ sortBy == 'a.poids' ? 'selected' }}>Poids croissant</option>
                                <option value="a.category" {{ sortBy == 'a.category' ? 'selected' }}>Catégorie</option>
                                <option value="a.titre" {{ sortBy == 'a.titre' ? 'selected' }}>Titre</option>
                            </select>
                        </div>
                        
                        <!-- Bouton de soumission -->
                        <button type="submit" class="btn filter-btn w-100">
                            <i class="fas fa-filter me-2"></i>Appliquer les filtres
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Contenu principal à droite -->
            <div class="col-lg-9 col-md-8">
                <!-- Categories Filter Section -->
                <section id="categories" class="categories section mb-4">
                    <h2 class="text-center mb-4 section-title">Catégories</h2>
                    <div class="row d-flex justify-content-center">
                        <div class="col-lg-12">
                            <div class="row">
                                {% for category in categories %}
                                    <div class="col-md-3 col-sm-6 mb-3">
                                        <div class="category-card text-center shadow-sm">
                                            <a href="{{ app.request.get('_route') == 'app_annonce_search' 
                                                ? path('app_annonce_search', {
                                                    'q': searchTerm|default(''),
                                                    'category': category.id,
                                                    'min_price': minPrice,
                                                    'max_price': maxPrice,
                                                    'min_weight': minWeight,
                                                    'max_weight': maxWeight,
                                                    'sort_by': sortBy
                                                }) 
                                                : path('app_annonce_index_front', {
                                                    'category': category.id,
                                                    'min_price': minPrice,
                                                    'max_price': maxPrice,
                                                    'min_weight': minWeight,
                                                    'max_weight': maxWeight,
                                                    'sort_by': sortBy
                                                }) }}"
                                            class="category-link {{ selectedCategoryId == category.id ? 'active' : '' }}">
                                                {{ category.name }}
                                            </a>
                                        </div>
                                    </div>
                                {% else %}
                                    <p class="text-center no-category">Aucune catégorie disponible.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </section>
                <!-- /Categories Filter Section -->
                
                <!-- Affichage des résultats de recherche si applicable -->
                {% if app.request.get('_route') == 'app_annonce_search' and searchTerm is defined and searchTerm is not empty %}
                    <div class="search-results-info mb-4">
                        <h3 class="search-results-title">
                            Résultats pour "{{ searchTerm }}" 
                            {% if annonces|length > 0 %}
                                <span class="badge bg-success">{{ annonces.getTotalItemCount }} trouvé(s)</span>
                            {% endif %}
                        </h3>
                        <a href="{{ path('app_annonce_index_front') }}" class="btn btn-outline-secondary btn-sm mt-2">
                            <i class="fas fa-times me-1"></i>Effacer la recherche
                        </a>
                    </div>
                {% endif %}

                <!-- Liste des Annonces -->
                <div class="filters-content">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="annonces-title">Nos Annonces</h2>
                        <a href="{{ path('app_annonce_new_front') }}" class="btn add-annonce-btn">
                            <i class="fas fa-plus me-2"></i>Ajouter une Annonce
                        </a>
                    </div>

                    <div class="row grid">
                        {% if annonces is not empty %}
                            {% for annonce in annonces %}
                                <div class="col-sm-6 col-lg-4 all annonce mb-4">
                                    <div class="card shadow-sm">
                                        <div class="img-box">
                                            {% if annonce.image %}
                                                <img src="{{ asset('uploads/' ~ annonce.image) }}" alt="Image de l'annonce" class="img-fluid rounded-top">
                                            {% else %}
                                                <img src="{{ asset('assetsFront/assets/img/default-annonce.jpg') }}" alt="Image par défaut" class="img-fluid rounded-top">
                                            {% endif %}
                                        </div>
                                        <div class="card-body text-center">
                                            <h5 class="fw-bold annonce-title">{{ annonce.titre }}</h5>
                                            <p class="annonce-description">{{ annonce.description }}</p>

                                            <div class="annonce-details">
                                                <span class="label">Catégorie:</span>
                                                <span class="category-text">{{ annonce.category.name }}</span>
                                            </div>

                                            <div class="annonce-details">
                                                <span class="label">Prix:</span>
                                                <span class="price-text">${{ annonce.prix }}</span>
                                            </div>

                                            <div class="annonce-details">
                                                <span class="label">Poids:</span>
                                                <span class="weight-text">{{ annonce.poids }} kg</span>
                                            </div>

                                            <button class="btn add-to-cart mt-3">
                                                <i class="fas fa-shopping-cart"></i> Ajouter au panier
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="no-results">
                                    <i class="fas fa-search fa-3x mb-3"></i>
                                    <p class="text-center">Aucune annonce disponible pour ces critères.</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    {{ knp_pagination_render(annonces) }}
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block stylesheets %}
<style>
   /* General Card Styling */
   .card {
       border: none;
       border-radius: 15px;
       overflow: hidden;
       transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
       background: #fff;
       padding: 15px;
       box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
   }

   .card:hover {
       transform: translateY(-5px);
       box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.2);
   }

   /* Title Styling */
   .annonce-title {
       font-size: 18px;
       font-weight: bold;
       color: #333;
   }

   /* Description */
   .annonce-description {
       font-size: 14px;
       color: #666;
       margin-bottom: 10px;
   }

   /* Details Styling */
   .annonce-details {
       display: flex;
       justify-content: space-between;
       font-size: 14px;
       margin-bottom: 5px;
   }

   .label {
       font-weight: bold;
       color: #555;
   }

   .category-text {
       color: green;
       font-weight: bold;
   }

   .price-text {
       color:rgb(7, 51, 5);
       font-weight: bold;
   }

   /* Image Box */
   .img-box img {
       max-height: 250px;
       object-fit: cover;
       width: 100%;
       border-top-left-radius: 15px;
       border-top-right-radius: 15px;
   }

   /* Add to Cart Button */
   .add-to-cart {
       background: linear-gradient(45deg,rgb(9, 81, 12),rgb(23, 184, 61));
       color: white;
       border: none;
       padding: 10px 15px;
       border-radius: 25px;
       font-size: 14px;
   }

   /* General Section Styling */
   .categories.section {
       padding: 40px 0;
       background-color: #f8f9fa;
       border-radius: 10px;
   }

   /* Section Title */
   .section-title {
       font-size: 24px;
       font-weight: bold;
       color: #333;
       text-transform: uppercase;
       margin-bottom: 30px;
       position: relative;
   }
   
   .section-title:after {
       content: "";
       position: absolute;
       width: 60px;
       height: 3px;
       background: linear-gradient(45deg,rgb(9, 81, 12),rgb(23, 184, 61));
       bottom: -10px;
       left: 50%;
       transform: translateX(-50%);
   }

   /* Category Card */
   .category-card {
       background: white;
       border-radius: 10px;
       padding: 15px;
       transition: all 0.3s ease-in-out;
       border: 1px solid #ddd;
   }

   .category-card:hover {
       transform: translateY(-5px);
       box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.15);
   }

   /* Category Link */
   .category-link {
       display: block;
       padding: 10px 15px;
       font-size: 16px;
       font-weight: bold;
       color: #333;
       text-decoration: none;
       transition: all 0.3s ease-in-out;
       border-radius: 8px;
   }

   /* Hover Effect */
   .category-link:hover {
       color: white;
       background: linear-gradient(45deg, #53bb6b, #368749);
       box-shadow: 0px 4px 10px rgba(255, 127, 80, 0.3);
   }

   /* Active Category */
   .category-link.active {
       color: white;
       background: #368749;
   }

   /* No Category Message */
   .no-category {
       font-size: 16px;
       color: #777;
       text-align: center;
       padding: 20px;
   }

   /* Style pour la pagination */
   .pagination {
       text-align: center;
       margin-top: 20px;
   }

   .pagination ul {
       list-style: none;
       padding: 0;
       display: flex;
       justify-content: center;
       gap: 10px;
   }

   .pagination li {
       display: inline-block;
   }

   .pagination a, .pagination span {
       text-decoration: none;
       padding: 8px 12px;
       border-radius: 5px;
       border: 1px solid rgba(21, 160, 26, 0.46);
       color:rgb(34, 108, 52);
       transition: 0.3s;
   }

   .pagination a:hover {
      background-color: rgb(23, 106, 43);
      color: white;
   }

   .pagination .current {
      background-color: #158A20 !important; /* Vert forcé */
      color: white !important; /* Numéro en blanc forcé */
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 5px;
      border: 1px solid #0F6A17; /* Bordure verte plus foncée */
   }
   
   .page-item.active .page-link {
      z-index: 1;
      color: #fff !important; /* Force la couleur du texte à blanc */
      background-color: #2a7c2e !important; /* Fond vert foncé */
      border-color:rgb(41, 124, 45) !important; /* Bordure verte assortie */
      font-weight: bold;
   }

   /* Nouvelle section de style pour le filtrage professionnel */
   .shop-container {
       margin-top: 30px;
   }

   .filter-sidebar {
       background: white;
       border-radius: 12px;
       box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
       padding: 0;
       overflow: hidden;
   }

   .filter-header {
       background: linear-gradient(45deg, #368749, #53bb6b);
       color: white;
       padding: 15px 20px;
       border-top-left-radius: 12px;
       border-top-right-radius: 12px;
   }

   .filter-header h4 {
       margin: 0;
       font-size: 18px;
       font-weight: 600;
   }

   .filter-section {
       padding: 15px 20px;
       border-bottom: 1px solid #eee;
   }

   .filter-section:last-child {
       border-bottom: none;
   }

   .filter-title {
       font-size: 16px;
       font-weight: 600;
       color: #444;
       margin-bottom: 12px;
       position: relative;
   }
   
   .filter-title:after {
       content: '';
       display: block;
       width: 30px;
       height: 2px;
       background-color: #368749;
       margin-top: 5px;
   }

   .input-group {
       margin-bottom: 10px;
   }

   .input-group-text {
       background-color: #f0f0f0;
       color: #444;
       font-weight: 500;
       border-color: #ddd;
       min-width: 70px;
       justify-content: center;
   }

   .form-control, .form-select {
       border: 1px solid #ddd;
       font-size: 14px;
       padding: 8px 12px;
   }

   .form-control:focus, .form-select:focus {
       border-color: #53bb6b;
       box-shadow: 0 0 0 0.2rem rgba(83, 187, 107, 0.25);
   }

   .filter-btn {
       background: linear-gradient(45deg, #368749, #53bb6b);
       color: white;
       font-weight: 500;
       padding: 10px 15px;
       border-radius: 8px;
       margin-top: 15px;
       border: none;
       transition: all 0.3s ease;
   }

   .filter-btn:hover {
       background: linear-gradient(45deg, #307240, #49a85e);
       box-shadow: 0 5px 15px rgba(54, 135, 73, 0.3);
       transform: translateY(-2px);
       color: white;
   }

   .annonces-title {
       font-size: 24px;
       font-weight: 700;
       color: #333;
       margin-bottom: 0;
   }

   .add-annonce-btn {
       background: linear-gradient(45deg, #368749, #53bb6b);
       color: white;
       border: none;
       padding: 10px 20px;
       border-radius: 8px;
       font-weight: 500;
       transition: all 0.3s ease;
   }

   .add-annonce-btn:hover {
       background: linear-gradient(45deg, #307240, #49a85e);
       transform: translateY(-2px);
       box-shadow: 0 4px 12px rgba(54, 135, 73, 0.3);
       color: white;
   }
   
   /* Nouvelles styles pour la barre de recherche */
   .search-container {
       margin-bottom: 20px;
   }
   
   .search-form {
       width: 100%;
       display: flex;
   }
   
   .search-input {
       border-radius: 50px 0 0 50px;
       padding: 15px 20px;
       font-size: 16px;
       border: 2px solid #eaeaea;
       box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
       transition: all 0.3s ease;
   }
   
   .search-input:focus {
       border-color: #53bb6b;
       box-shadow: 0 2px 15px rgba(83, 187, 107, 0.2);
   }
   
   .search-btn {
       border-radius: 0 50px 50px 0;
       padding: 0 25px;
       background: linear-gradient(45deg, #368749, #53bb6b);
       color: white;
       border: none;
       transition: all 0.3s ease;
   }
   
   .search-btn:hover {
       background: linear-gradient(45deg, #307240, #49a85e);
       color: white;
   }
   
   /* Style pour les résultats de recherche */
   .search-results-info {
       background-color: #f8f9fa;
       border-radius: 10px;
       padding: 15px 20px;
       margin-bottom: 20px;
   }
   
   .search-results-title {
       font-size: 18px;
       color: #333;
       margin-bottom: 5px;
   }
   
   .badge {
       font-size: 14px;
       padding: 5px 10px;
       border-radius: 20px;
       margin-left: 10px;
       background-color: #53bb6b;
   }
   
   /* Style pour "Aucun résultat" */
   .no-results {
       text-align: center;
       padding: 40px 20px;
       background-color: #f8f9fa;
       border-radius: 10px;
       color: #777;
   }
   
   .no-results i {
       color: #53bb6b;
       opacity: 0.6;
   }
</style>
{% endblock %}